+++
title = "N+1 문제란"
date = "2023-09-16T05:10:00-06:00"
categories = ["jpa"]
+++
N+1 문제의 예를들어 쉽게 설명 해보겠습니다.  
다음과 같은 쿼리로 MEMBER 100명을 조회합니다.
```sql
SELECT * FROM MEMBER;
```
하지만 이 조회로 끝나는게 아니라 TEAM에 대한 조회가 필요하다면 MEMBER 조회 시 TEAM에 대한 조회도 같이 이루어집니다.  
결국 100명의 회원에 대한 조회에서 회원마다의 팀 조회까지 이루어져 총 **1 + 100 = 101** 번의 SQL 조회가 이루어 집니다.
그래서 저는 이 현상을 **1 + N** 조회라고 기억하는 편입니다. 

이러한 문제를 해결하기 위해 몇 가지 방법이 있습니다.
1. **EAGER 로딩 설정 변경** : FetcyType을 EAGER로 변경하여 모든 엔티티를 한번에 검색하여 1번의 SQL로 필요한 모든 데이터를 가져올 수 있습니다. 하지만 이 방법은 성능 문제를 유발하므로 신중하게 사용해야 합니다.
2. **Fetch Join** : JPQL 쿼리를 사용하여 Fetch Join을 사용하면 한번의 쿼리로 필요한 데이터를 가져 올 수 있습니다.
3. **쿼리 최적화** : Native 쿼리나 JPQL을 사용하여 필요한 데이터만 검색하도록 쿼리를 최적화 할 수 있습니다.